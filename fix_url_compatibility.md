# Исправление проблемы с URL в API и веб-интерфейсе

## Описание проблемы

Обнаружена критическая проблема с API-запросами: веб-интерфейс не может получить данные и выдает ошибку 500 из-за несовместимости URL-путей. 

Проблема заключается в том, что:
1. API-сервер ожидает URL с обязательным слешем в конце (`/cities/`)
2. Прокси Next.js перенаправляет запросы без слеша в конце (`/cities`)
3. Некоторые функции в `utils/api.js` используют URL без слеша в конце

## Выполненные исправления

Мы внесли следующие изменения:

### 1. В конфигурации Next.js (`frontend/next.config.js`):
- Включили опцию `trailingSlash: true` для сохранения слеша в конце URL
- Настроили правила `rewrites` для обеспечения отправки слеша в конце URL
- Добавили специальные правила для конкретных маршрутов, таких как `/api/cities`
- Увеличили таймаут для запросов и отключили сжатие для упрощения отладки

### 2. В файле API клиента (`frontend/src/utils/api.js`):
- Унифицировали все URL функций, добавив слеш в конце, например: `/teams/${id}/`

### 3. На сервере API (`backend/app/main.py`):
- Добавили middleware `add_trailing_slash`, который автоматически добавляет слеш в конце URL, если его нет
- Добавили обработчики исключений для всех типов ошибок
- Улучшили логирование с трассировкой стека
- Обеспечили более надежную обработку URL с числовыми идентификаторами

### 4. В файле подключения к базе данных (`backend/app/database.py`):
- Изменили настройки подключения к базе данных, чтобы использовать PostgreSQL вместо SQLite

### 5. Создали инструмент диагностики API (`api_diagnostic.js`):
- Скрипт для выполнения в консоли браузера для проверки прямых API-запросов и запросов через прокси

## Как применить исправления

Для применения этих исправлений необходимо:

1. **Обновить файлы**:
   - Скопировать обновленные файлы в соответствующие папки
   - Или внести изменения вручную согласно описанию выше

2. **Перезапустить сервисы**:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

3. **Проверить работоспособность**:
   - Открыть веб-интерфейс и убедиться, что список городов отображается корректно
   - Проверить создание, редактирование и удаление городов

## Отладка проблем

Если после применения исправлений проблемы сохраняются:

1. **Использовать инструмент диагностики API**:
   - Откройте страницу в браузере
   - Откройте консоль разработчика (F12)
   - Скопируйте содержимое файла `api_diagnostic.js` и вставьте в консоль
   - Изучите результаты и ошибки

2. **Проверить логи сервера**:
   ```bash
   docker logs football_api
   ```

3. **Проверить запросы напрямую**:
   ```bash
   curl -v "http://192.168.1.124:8088/cities/"
   ```

4. **Проверить работу прокси**:
   ```bash
   curl -v "http://192.168.1.124:3000/api/cities/"
   ```

## Примечания

Эти изменения гарантируют, что:
1. Все API-запросы всегда имеют слеш в конце URL
2. Система использует только PostgreSQL в качестве базы данных
3. Прокси корректно обрабатывает URL-пути между фронтендом и бэкендом
4. Ошибки четко логируются и не приводят к сбоям в работе приложения 